<html>
<head>
<title>Exercise 3</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<h2>Exercise 3. std::any from scratch.</h2>

<p>
In this exercise, you will be implementing <code>std::any</code> by removing functionality
from <code>std::function</code>.

<p>
Open <a href="https://wandbox.org/permlink/eT5T1Ja8zUjR2ezf">this wandbox</a>
(<a href="3-main.cc">b</a>,
<a href="3-function.h">b</a>,
<a href="3-test-function.h">b</a>,
<a href="3-any.h">b</a>,
<a href="3-any-cast.h">b</a>,
<a href="3-test-any.h">b</a>).
The header file "function.h" contains a fundamentally complete implementation of
<code>std::function</code> (but without the Small Object Optimization).
This wandbox also contains a header file named "any.h" that is simply a copy of "function.h".

<p>
1. Read "function.h" from top to bottom. Does it make sense? Can you match up the
class definitions in the actual code with the pieces of the diagram from today's
slide presentation?

<p>
2. Modify "any.h" so that it is a valid implementation of <code>std::any</code>.
You can try to do it on your own, or you can follow this checklist.
The necessary changes are:
<ul>
<li>Remove the template type parameter <code>Signature</code>. <code>class any</code> is
a concrete class, not a template.</li>
<li>Rip out the special construction logic dealing with <code>nullptr_t</code> and
<code>is_specialization_of_function_v</code>.</li>
<li>Rip out <code>operator()</code>.</li>
<li>Rip out <code>operator bool</code>.</li>
<li>Rename the method <code>target_type()</code> to <code>type()</code>.</li>
<li>Change the name of the class from <code>function</code> to <code>any</code>.</li>
</ul>
Run the tests; do they pass? (They should!)

<p>
3. (Optional) Notice that we left <code>any::target()</code> as a public member function,
whereas in the actual standard library there is no such function (just <code>any_cast</code>).
Make <code>any::target()</code> a private member function and make <code>any_cast</code> a friend
of <code>any</code>.
In your opinion, which interface seems "better": private-member-function-and-friend,
or public-member-function? Why?


<hr>
<p>
You're done with the third set of exercises! Sit back and relax, or optionally,
browse the following blog posts.

<ul>
<li><a href="http://www.gotw.ca/publications/mill02.htm">"What's In a Class? The Interface Principle." Herb Sutter, 1998.</a></li>
<li><a href="https://outflux.net/blog/archives/2011/12/22/abusing-the-file-structure/">"Abusing the FILE structure." Kees Cook, 2011.</a></li>
<li><a href="https://eli.thegreenplace.net/2016/a-polyglots-guide-to-multiple-dispatch/">"A polyglot's guide to multiple dispatch." Eli Bendersky, 2016.</a></li>
</ul>

</body>
</html>
